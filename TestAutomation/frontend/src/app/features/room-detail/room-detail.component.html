<div class="room-detail-page" *ngIf="room">
  <div class="breadcrumb">
    <a routerLink="/">Trang chủ</a> <span>/</span> <span>{{ room.name }}</span>
  </div>

  <div class="header-section">
    <div>
      <h1>{{ room.name }}</h1>
      <p class="address">{{ room.building?.address || 'Đang cập nhật' }}</p>
    </div>
    <div class="actions">
      <button class="btn btn-secondary">
        <i class="fa-regular fa-heart"></i> Yêu thích
      </button>
    </div>
  </div>

  <!-- Bộ ảnh -->
  <div class="image-gallery" *ngIf="room.images?.length > 0">
    <div class="main-image">
      <img
        [src]="currentMainImage"
        alt="Room image"
        (click)="openLightbox(currentImageIndex)"
      />
      <div class="nav-arrows">
        <button class="nav-arrow" (click)="prevImage($event)">
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="nav-arrow" (click)="nextImage($event)">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
    </div>

    <div class="thumbnail-images">
      <img
        *ngFor="let img of room.images; let i = index"
        [src]="normalizeImage(img.imageUrl)"
        [class.active]="i === currentImageIndex"
        (click)="changeMainImage(img.imageUrl, i)"
        alt="Room thumbnail"
      />
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" *ngIf="isLightboxOpen" (click)="closeLightbox($event)">
    <button class="lightbox-nav left" (click)="prevLightboxImage($event)">
      <i class="fa-solid fa-chevron-left"></i>
    </button>
    <img [src]="lightboxImage" alt="Ảnh phóng to" />
    <button class="lightbox-nav right" (click)="nextLightboxImage($event)">
      <i class="fa-solid fa-chevron-right"></i>
    </button>
  </div>

  <!-- Thông tin -->
  <div class="info-bar">
    <div>
      <span>Giá thuê</span>
      <strong>{{ room.price | number }}đ/tháng</strong>
    </div>
    <div>
      <span>Diện tích</span>
      <strong>{{ room.area }} m²</strong>
    </div>
    <div>
      <span>Tình trạng</span>
      <strong [ngClass]="room.status === 'AVAILABLE' ? 'text-success' : 'text-danger'">
        {{ room.status === 'AVAILABLE' ? 'Còn phòng' : 'Hết phòng' }}
      </strong>
    </div>
    <div>
      <span>Ngày đăng</span>
      <strong>{{ room.createdAt | date: 'dd/MM/yyyy' }}</strong>
    </div>
  </div>

  <div class="content-grid">
    <div class="content-section">
      <h2>Mô tả</h2>
      <p>{{ room.description }}</p>

      <h2>Tiện nghi</h2>
      <ul class="amenities-list" *ngIf="amenities?.length; else noAmenities">
        <li *ngFor="let a of amenities">
          <i class="fa-solid fa-circle-check"></i> {{ a.name }}
        </li>
      </ul>

      <ng-template #noAmenities>
        <p>Không có tiện nghi được cung cấp.</p>
      </ng-template>

      <h2>Bản đồ</h2>
      <div class="map-container">
        <iframe
          width="100%"
          height="250"
          frameborder="0"
          style="border:0"
          [src]="'https://maps.google.com/maps?q=' + room.building?.address + '&output=embed'"
          allowfullscreen
        ></iframe>
      </div>

      <div class="notes-box">
        <h3>Lưu ý</h3>
        <ul>
          <li>Giữ liên lạc với chủ trọ qua số điện thoại rõ ràng.</li>
          <li>Không chuyển tiền trước khi xem phòng.</li>
        </ul>
      </div>
    </div>

    <aside class="sidebar">
      <div class="booking-card">
        <div class="price-section">
          {{ room.price | number }}đ
          <span>/tháng</span>
        </div>
        <div class="quick-info">
          <span><i class="fa-solid fa-star"></i> 4.5/5 đánh giá</span>
          <span><i class="fa-solid fa-phone"></i> 0909000001</span>
        </div>
        <div class="contact-buttons">
          <button class="btn btn-primary btn-full">Đặt thuê ngay</button>
          <button class="btn btn-secondary btn-full">Nhắn tin</button>
        </div>
        <div class="important-note">
          <i class="fa-solid fa-triangle-exclamation"></i>
          <p>Hãy kiểm tra thông tin chủ trọ kỹ lưỡng trước khi đặt cọc.</p>
        </div>
      </div>
    </aside>
  </div>
</div>
