<header class="header-container">
  <div class="header-left">
    <button class="toggle-btn" (click)="onToggleSidebar()">
      <i class="fa-solid fa-bars"></i>
    </button>
    
    <div class="header-title-section">
      <h1 class="header-title">Dashboard Admin</h1>
    </div>
  </div>

  <div class="header-right">
    <div class="search-bar">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input type="text" placeholder="Tìm kiếm..." />
    </div>

    <!-- NOTIFICATION BELL ICON -->
    <div class="notification-wrapper">
      <button class="notification-bell" (click)="toggleNotifications($event)" title="Thông báo">
        <i class="fa fa-bell"></i>
        <span class="notif-badge" *ngIf="unreadCount > 0">
          {{ unreadCount > 99 ? '99+' : unreadCount }}
        </span>
      </button>

      <!-- Notifications dropdown panel -->
      <div class="notification-dropdown" *ngIf="showNotifications">
        <div class="notif-header">
          <strong>Thông báo</strong>
          <button class="mark-all" (click)="markAll()" *ngIf="hasUnread">
            Đánh dấu tất cả
          </button>
        </div>

        <div *ngIf="notificationLoading" class="notif-loading">
          <i class="fa fa-spinner fa-spin"></i> Đang tải...
        </div>

        <div *ngIf="!notificationLoading && notifications.length === 0" class="notif-empty">
          Không có thông báo
        </div>

        <ul class="notif-list" *ngIf="!notificationLoading && notifications.length > 0">
          <li *ngFor="let n of notifications" 
              class="notif-item" 
              [class.unread]="!n.isRead">
            <div class="left" (click)="onNotificationClick(n, $event)">
              <div class="notif-title">{{ n.title }}</div>
              <div class="notif-msg">
                {{ isExpanded(n) ? n.message : shortMessage(n) }}
              </div>
              <div class="time">{{ n.createdAt | date:'dd/MM/yyyy HH:mm' }}</div>
            </div>
            <div class="right">
              <button class="btn-delete" (click)="onDeleteNotification(n.id, $event)" title="Xóa">
                <i class="fa fa-times"></i>
              </button>
            </div>
          </li>
        </ul>

        <div class="notif-footer" *ngIf="notifications.length > 0">
          <a (click)="openAllNotifications()" class="view-all">
            Xem tất cả <i class="fa fa-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>

    <div class="user-menu-wrapper" *ngIf="currentUser">
      <div class="user-menu" (click)="toggleUserDropdown()">
        <span class="user-name">{{ currentUser.fullName }}</span>
        <i class="fa-solid fa-chevron-down" [class.rotate]="showUserDropdown"></i>
      </div>

      <div class="dropdown-menu" *ngIf="showUserDropdown">
        <div class="dropdown-header">
          <p class="dropdown-name">{{ currentUser.fullName }}</p>
          <p class="dropdown-role">{{ getRoleName(currentUser.role) }}</p>
        </div>

        <div class="dropdown-divider"></div>

        <a class="dropdown-item" (click)="goToHome()">
          <i class="fa-solid fa-house"></i>
          <span>Trang chủ</span>
        </a>

        <a class="dropdown-item" (click)="goToProfile()">
          <i class="fa-solid fa-user"></i>
          <span>Thông tin cá nhân</span>
        </a>

        <a class="dropdown-item" routerLink="/admin/settings" (click)="showUserDropdown = false">
          <i class="fa-solid fa-gear"></i>
          <span>Cài đặt</span>
        </a>

        <div class="dropdown-divider"></div>

        <a class="dropdown-item logout" (click)="logout()">
          <i class="fa-solid fa-right-from-bracket"></i>
          <span>Đăng xuất</span>
        </a>
      </div>
    </div>
  </div>
</header>

<div class="dropdown-backdrop" *ngIf="showUserDropdown" (click)="showUserDropdown = false"></div>