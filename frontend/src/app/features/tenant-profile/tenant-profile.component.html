<div class="tenant-profile-container">
  
  <div class="grid">
    <div class="left-column">
      <div class="card">
        <div class="profile-header">
          <div class="profile-avatar">
            {{ user?.fullName?.charAt(0) || '?' }}
          </div>
          <div class="profile-name">{{ user?.fullName }}</div>
          <div class="profile-role">Kh√°ch thu√™</div>
        </div>

        <div *ngIf="!editMode" class="profile-view">
          <div class="info-row">
            <div class="info-label">Name</div>
            <div class="info-value">{{ user?.fullName || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</div>
          </div>
          
          <div class="info-row">
            <div class="info-label">Email</div>
            <div class="info-value">{{ user?.email || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</div>
          </div>

          <button class="btn-edit" (click)="toggleEditMode()">
            Edit profile
          </button>

          <div class="quick-actions" style="margin-top:12px">
            <button class="quick-action-btn" (click)="toggleInvoices()" style="display:flex;align-items:center;justify-content:center;gap:8px">
              <div class="action-icon">üìÑ</div>
              <div class="action-label">Xem h√≥a ƒë∆°n</div>
            </button>
          </div>
        </div>

        <form *ngIf="editMode" [formGroup]="profileForm" (ngSubmit)="onSave()" class="profile-form">
          <div class="form-group">
            <label>H·ªç v√† t√™n</label>
            <input 
              type="text" 
              formControlName="fullName"
              class="form-control"
              placeholder="Nh·∫≠p h·ªç v√† t√™n"
            />
            <span *ngIf="profileForm.get('fullName')?.invalid && profileForm.get('fullName')?.touched" 
                  class="error-text">
              Vui l√≤ng nh·∫≠p h·ªç v√† t√™n
            </span>
          </div>

          <div class="form-group">
            <label>Email</label>
            <input 
              type="email" 
              formControlName="email"
              class="form-control"
              placeholder="Nh·∫≠p email"
            />
            <span *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" 
                  class="error-text">
              Email kh√¥ng h·ª£p l·ªá
            </span>
          </div>

          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i</label>
            <input 
              type="text" 
              formControlName="phone"
              class="form-control"
              placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
            />
            <span *ngIf="profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched" 
                  class="error-text">
              Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i
            </span>
          </div>

          <div class="form-group">
            <label>CCCD/CMND</label>
            <input 
              type="text" 
              formControlName="cccd"
              class="form-control"
              placeholder="Nh·∫≠p s·ªë CCCD/CMND"
            />
          </div>

          <div class="form-group">
            <label>Ng√†y sinh</label>
            <input 
              type="date" 
              formControlName="dateOfBirth"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>T·ªânh/Th√†nh ph·ªë</label>
            <select 
              formControlName="provinceCode"
              class="form-control"
              (change)="onProvinceChange($event)">
              <option [ngValue]="null">-- Ch·ªçn T·ªânh/Th√†nh --</option>
              <option *ngFor="let province of provinces" [value]="province.code">
                {{ province.name }}
              </option>
            </select>
          </div>
        
          <div class="form-group">
            <label>Qu·∫≠n/Huy·ªán</label>
            <select 
              formControlName="districtCode"
              class="form-control"
              [disabled]="!districts.length">
              <option [ngValue]="null">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>
              <option *ngFor="let district of districts" [value]="district.code">
                {{ district.name }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>ƒê·ªãa ch·ªâ chi ti·∫øt</label>
            <textarea 
              formControlName="address"
              class="form-control"
              rows="2"
              placeholder="Nh·∫≠p s·ªë nh√†, t√™n ƒë∆∞·ªùng, ph∆∞·ªùng/x√£"
            ></textarea>
          </div>
          
          <div class="form-actions">
            <button 
              type="submit" 
              class="btn-save"
              [disabled]="profileForm.invalid || saving"
            >
              {{ saving ? 'ƒêang l∆∞u...' : 'L∆∞u' }}
            </button>
            
            <button 
              type="button" 
              class="btn-cancel"
              (click)="toggleEditMode()"
              [disabled]="saving"
            >
              H·ªßy
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="middle-column">
      <div class="card">
        <h2 class="card-title">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h2>
        <div class="activities">
          <p class="no-data-text">C√°c ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y.</p>
        </div>
      </div>
    </div>

    <div class="right-column">
      <div class="card">
        <h2 class="card-title">Th√¥ng tin ph√≤ng</h2>
        
        <div *ngIf="room" class="room-info">
          <div class="room-badge">{{ room.name }}</div>
          
          <div class="stat-item">
            <div class="stat-label">üí∞ Gi√° thu√™</div>
            <div class="stat-value">{{ formatCurrency(room.price) }}</div>
          </div>
        </div>

        <div *ngIf="!room" class="no-data">
          <div class="no-data-icon">üè†</div>
          <p class="no-data-text">Ch∆∞a c√≥ th√¥ng tin ph√≤ng</p>
        </div>
      </div>

      <!-- Quick actions moved into personal info card on the left -->
    </div>
  </div>
  <!-- Embedded invoice section (toggle from quick action) -->
  <div *ngIf="showInvoices" id="tenant-invoices-section" class="card" style="margin-top:20px;">
    <h2 class="card-title">H√≥a ƒë∆°n c·ªßa t√¥i</h2>
    <app-invoice-view></app-invoice-view>
  </div>
</div>