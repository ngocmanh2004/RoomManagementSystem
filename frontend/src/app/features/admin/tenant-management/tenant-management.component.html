<div class="tenant-container">

  <!-- Header -->
  <div class="header-section">
    <h3>Quáº£n lÃ½ KhÃ¡ch thuÃª</h3>
    <div class="date">{{ today | date:'EEEE, d MMMM, y':'':'vi' }}</div>
  </div>

  <!-- Controls: TÃ¬m kiáº¿m + Filter + ThÃªm má»›i -->
  <div class="top-controls">
    <input type="text" [(ngModel)]="searchText" (input)="filterTenants()" 
           class="search-box" placeholder="TÃ¬m kiáº¿m theo tÃªn, SÄT, CCCD..." />

    <select [(ngModel)]="selectedStatus" (change)="filterTenants()">
      <option value="">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
      <option value="ACTIVE">Äang thuÃª</option>
      <option value="PENDING">ÄÃ£ nghá»‰</option>
    </select>

    <button class="btn-add" (click)="openAddForm()">+ ThÃªm khÃ¡ch thuÃª</button>
  </div>

  <!-- Thá»‘ng kÃª nhanh -->
  <div class="stats-row">
    <div class="stat-card total">
      <h4>Tá»•ng khÃ¡ch thuÃª</h4>
      <p>{{ tenants.length }}</p>
    </div>
    <div class="stat-card active">
      <h4>Äang thuÃª</h4>
      <p>{{ countDangThue }}</p>
    </div>
    <div class="stat-card pending">
      <h4>ÄÃ£ nghá»‰</h4>
      <p>{{ countDaNghi }}</p>
    </div>
    <div class="stat-card new">
      <h4>KhÃ¡ch má»›i thÃ¡ng nÃ y</h4>
       <p>{{ countKhachMoi }}</p>
    </div>
  </div>

  <!-- Báº£ng danh sÃ¡ch khÃ¡ch thuÃª -->
  <div class="table-section">
    <h5>Danh sÃ¡ch khÃ¡ch thuÃª ({{ tenants.length }})</h5>
    <table class="tenant-table">
      <thead>
        <tr>
          <th>ThÃ´ng tin khÃ¡ch thuÃª</th>
          <th>LiÃªn há»‡</th>
          <th>CCCD</th>
          <th>NgÃ y sinh</th>
          <th>Tráº¡ng thÃ¡i</th>
          <th>Thao tÃ¡c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let t of filteredTenants">
          
          <!-- ThÃ´ng tin khÃ¡ch thuÃª: avatar + tÃªn + ngÃ y tham gia -->
          <td>
            <div class="tenant-info">
              <div class="avatar">{{ t.user?.fullName?.charAt(0) }}</div>
              <div class="name">
                {{ t.user?.fullName }}
                <div class="small text-muted">
                  NgÃ y tham gia: {{ t.user?.createdAt | date:'dd/MM/yyyy' }}
                </div>
              </div>
            </div>
          </td>

          <!-- LiÃªn há»‡: SÄT + email dÆ°á»›i dÃ²ng nhá» -->
          <td>
            <div>{{ t.user?.phone }}</div>
            <div class="small text-muted">{{ t.user?.email }}</div>
          </td>

          <!-- CCCD -->
          <td>{{ t.cccd }}</td>

          <!-- NgÃ y sinh -->
          <td>{{ t.dateOfBirth | date:'dd/MM/yyyy' }}</td>

          <!-- Dropdown tráº¡ng thÃ¡i -->
          <td>
            <select [(ngModel)]="t.user.status" (change)="updateStatus(t)">
              <option value="ACTIVE">Äang thuÃª</option>
              <option value="PENDING">ÄÃ£ nghá»‰</option>
            </select>
          </td>

          <!-- Thao tÃ¡c: xem, sá»­a, xÃ³a -->
          <td class="actions text-center">
            <span class="icon view" title="Xem" (click)="viewTenant(t)">ğŸ‘ï¸</span>
            <span class="icon edit" title="Sá»­a" (click)="editTenant(t)">âœï¸</span>
            <span class="icon delete" title="XÃ³a" (click)="deleteTenant(t)">ğŸ—‘ï¸</span>
          </td>

        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal thÃªm / sá»­a / xem khÃ¡ch thuÃª -->
  <div class="modal" *ngIf="isFormVisible">
    <div class="modal-content">

      <!-- TiÃªu Ä‘á» modal -->
      <h3 *ngIf="mode === 'add'">ThÃªm khÃ¡ch thuÃª</h3>
      <h3 *ngIf="mode === 'edit'">Sá»­a thÃ´ng tin khÃ¡ch thuÃª</h3>
      <h3 *ngIf="mode === 'view'">ThÃ´ng tin khÃ¡ch thuÃª</h3>

      <!-- Form thÃªm / sá»­a -->
      <form *ngIf="mode !== 'view'; else viewMode" (ngSubmit)="saveTenant()" #tenantForm="ngForm">
        <label>Há» tÃªn:</label>
        <input type="text" [(ngModel)]="currentTenant.user.fullName" name="userFullName" required>

        <label>Sá»‘ Ä‘iá»‡n thoáº¡i:</label>
        <input type="text" [(ngModel)]="currentTenant.user.phone" name="userPhone" required>

        <label>Email:</label>
        <input type="text" [(ngModel)]="currentTenant.user.email" name="userEmail">

        <label>CCCD:</label>
        <input type="text" [(ngModel)]="currentTenant.cccd" name="cccd" required>

        <label>NgÃ y sinh:</label>
        <input type="date" [(ngModel)]="currentTenant.dateOfBirth" name="dateOfBirth">

        <label>Äá»‹a chá»‰:</label>
        <input type="text" [(ngModel)]="currentTenant.address" name="address">

        <div class="modal-buttons">
          <button type="submit">{{ mode === 'edit' ? 'Cáº­p nháº­t' : 'ThÃªm má»›i' }}</button>
          <button type="button" class="cancel" (click)="closeForm()">Há»§y</button>
        </div>
      </form>

      <!-- Cháº¿ Ä‘á»™ xem -->
      <ng-template #viewMode>
        <div class="view-mode">
          <p><strong>Há» tÃªn:</strong> {{ currentTenant.user?.fullName }}</p>
          <p><strong>SÄT:</strong> {{ currentTenant.user?.phone }}</p>
          <p><strong>Email:</strong> {{ currentTenant.user?.email }}</p>
          <p><strong>CCCD:</strong> {{ currentTenant.cccd }}</p>
          <p><strong>NgÃ y sinh:</strong> {{ currentTenant.dateOfBirth | date:'dd/MM/yyyy' }}</p>
          <p><strong>Äá»‹a chá»‰:</strong> {{ currentTenant.address }}</p>
          <div class="modal-buttons">
            <button class="cancel" (click)="closeForm()">ÄÃ³ng</button>
          </div>
        </div>
      </ng-template>

    </div>
  </div>

</div>
