<div class="approval-container">
  <!-- Header -->
  <div class="header">
    <h1>YÃªu cáº§u Ä‘Äƒng kÃ½ chá»§ trá»</h1>
  </div>

  <!-- Search and Filter -->
  <div class="filter-section">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="TÃ¬m kiáº¿m theo tÃªn, email hoáº·c CCCD..."
        [(ngModel)]="searchTerm"
        (input)="filterRequests()"
        class="search-input"
      />
    </div>

    <div class="status-filters">
      <button 
        class="filter-btn"
        [class.active]="selectedStatus === 'ALL'"
        (click)="filterByStatus('ALL')"
      >
        Táº¥t cáº£ ({{ allRequests.length }})
      </button>
      <button 
        class="filter-btn filter-pending"
        [class.active]="selectedStatus === 'PENDING'"
        (click)="filterByStatus('PENDING')"
      >
        Chá» duyá»‡t ({{ statistics['PENDING'] || 0 }})
      </button>
      <button 
        class="filter-btn filter-approved"
        [class.active]="selectedStatus === 'APPROVED'"
        (click)="filterByStatus('APPROVED')"
      >
        ÄÃ£ duyá»‡t ({{ statistics['APPROVED'] || 0 }})
      </button>
      <button 
        class="filter-btn filter-rejected"
        [class.active]="selectedStatus === 'REJECTED'"
        (click)="filterByStatus('REJECTED')"
      >
        Tá»« chá»‘i ({{ statistics['REJECTED'] || 0 }})
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Äang táº£i dá»¯ liá»‡u...</p>
  </div>

  <!-- Table -->
  <div *ngIf="!loading" class="content">
    <div class="section">
      <h2>Danh sÃ¡ch yÃªu cáº§u ({{ filteredRequests.length }})</h2>
      
      <div *ngIf="filteredRequests.length === 0" class="empty-state">
        <span class="icon">ğŸ“‹</span>
        <p>KhÃ´ng tÃ¬m tháº¥y yÃªu cáº§u nÃ o</p>
      </div>

      <div class="table-container" *ngIf="filteredRequests.length > 0">
        <table class="landlord-table">
          <thead>
            <tr>
              <th>Há» tÃªn</th>
              <th>Email</th>
              <th>CCCD</th>
              <th>Äá»‹a chá»‰</th>
              <th>Giáº¥y phÃ©p KD</th>
              <th>NgÃ y gá»­i</th>
              <th>Tráº¡ng thÃ¡i</th>
              <th>HÃ nh Ä‘á»™ng</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let request of filteredRequests">
              <td>
                <div class="user-cell">
                  <div class="avatar">{{ request.user.fullName.charAt(0) }}</div>
                  <span>{{ request.user.fullName }}</span>
                </div>
              </td>
              <td>{{ request.user.email }}</td>
              <td>{{ request.cccd }}</td>
              <td class="address-cell">{{ request.address }}</td>
              <td>
                <a 
                  *ngIf="request.businessLicensePath" 
                  href="#" 
                  (click)="openDocument(request.businessLicensePath); $event.preventDefault()"
                  class="doc-link"
                >
                  {{ getDocumentId(request) }}
                </a>
                <span *ngIf="!request.businessLicensePath" class="muted">-</span>
              </td>
              <td>{{ request.createdAt | date:'yyyy-MM-dd' }}</td>
              <td>
                <span class="status-badge" [ngClass]="getStatusBadgeClass(request.status)">
                  {{ getStatusText(request.status) }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button 
                    class="btn-icon btn-view" 
                    (click)="viewDetail(request)"
                    title="Xem chi tiáº¿t"
                  >
                    <span>ğŸ‘</span>
                  </button>
                  <button 
                    *ngIf="request.status === 'PENDING'"
                    class="btn-icon btn-approve" 
                    (click)="approveRequest(request.id)"
                    title="Duyá»‡t"
                  >
                    <span>âœ“</span>
                  </button>
                  <button 
                    *ngIf="request.status === 'PENDING'"
                    class="btn-icon btn-reject" 
                    (click)="openRejectModal(request)"
                    title="Tá»« chá»‘i"
                  >
                    <span>âœ•</span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal chi tiáº¿t -->
<div class="modal-overlay" *ngIf="selectedRequest" (click)="closeDetail()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Chi tiáº¿t Ä‘Äƒng kÃ½</h2>
      <button class="btn-close" (click)="closeDetail()">âœ•</button>
    </div>
    
    <div class="modal-body">
      <div class="detail-section">
        <h3>ThÃ´ng tin ngÆ°á»i dÃ¹ng</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="label">Há» tÃªn:</span>
            <span class="value">{{ selectedRequest.user.fullName }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Email:</span>
            <span class="value">{{ selectedRequest.user.email }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Sá»‘ Ä‘iá»‡n thoáº¡i:</span>
            <span class="value">{{ selectedRequest.user.phone || 'ChÆ°a cáº­p nháº­t' }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h3>ThÃ´ng tin Ä‘Äƒng kÃ½</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="label">CCCD/CMND:</span>
            <span class="value">{{ selectedRequest.cccd }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Äá»‹a chá»‰:</span>
            <span class="value">{{ selectedRequest.address }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Sá»‘ phÃ²ng dá»± kiáº¿n:</span>
            <span class="value">{{ selectedRequest.expectedRoomCount }} phÃ²ng</span>
          </div>
          <div class="detail-item">
            <span class="label">Tráº¡ng thÃ¡i:</span>
            <span class="status-badge" [ngClass]="getStatusBadgeClass(selectedRequest.status)">
              {{ getStatusText(selectedRequest.status) }}
            </span>
          </div>
        </div>
      </div>

      <div class="detail-section" *ngIf="selectedRequest.rejectionReason">
        <h3>LÃ½ do tá»« chá»‘i</h3>
        <p class="rejection-reason">{{ selectedRequest.rejectionReason }}</p>
      </div>

      <div class="detail-section">
        <h3>TÃ i liá»‡u Ä‘Ã­nh kÃ¨m</h3>
        <div class="documents">
          <div class="doc-item" *ngIf="selectedRequest.frontImagePath">
            <a href="#" (click)="openDocument(selectedRequest.frontImagePath); $event.preventDefault()">
              ğŸ“„ CCCD máº·t trÆ°á»›c
            </a>
          </div>
          <div class="doc-item" *ngIf="selectedRequest.backImagePath">
            <a href="#" (click)="openDocument(selectedRequest.backImagePath); $event.preventDefault()">
              ğŸ“„ CCCD máº·t sau
            </a>
          </div>
          <div class="doc-item" *ngIf="selectedRequest.businessLicensePath">
            <a href="#" (click)="openDocument(selectedRequest.businessLicensePath); $event.preventDefault()">
              ğŸ“„ Giáº¥y phÃ©p kinh doanh
            </a>
          </div>
          <div *ngIf="!selectedRequest.frontImagePath && !selectedRequest.backImagePath && !selectedRequest.businessLicensePath">
            <p class="muted">KhÃ´ng cÃ³ tÃ i liá»‡u Ä‘Ã­nh kÃ¨m</p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer" *ngIf="selectedRequest.status === 'PENDING'">
      <button class="btn-approve" (click)="approveRequest(selectedRequest.id)">
        âœ“ Duyá»‡t Ä‘Äƒng kÃ½
      </button>
      <button class="btn-reject" (click)="openRejectModal(selectedRequest)">
        âœ• Tá»« chá»‘i
      </button>
    </div>
  </div>
</div>

<!-- Modal tá»« chá»‘i -->
<div class="modal-overlay" *ngIf="showRejectModal" (click)="closeRejectModal()">
  <div class="modal-content modal-sm" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Tá»« chá»‘i Ä‘Äƒng kÃ½</h2>
      <button class="btn-close" (click)="closeRejectModal()">âœ•</button>
    </div>
    
    <div class="modal-body">
      <label>LÃ½ do tá»« chá»‘i:</label>
      <textarea 
        [(ngModel)]="rejectionReason"
        class="form-control"
        rows="4"
        placeholder="Nháº­p lÃ½ do tá»« chá»‘i..."
      ></textarea>
    </div>

    <div class="modal-footer">
      <button class="btn-confirm-reject" (click)="confirmReject()">
        XÃ¡c nháº­n tá»« chá»‘i
      </button>
      <button class="btn-cancel" (click)="closeRejectModal()">
        Há»§y
      </button>
    </div>
  </div>
</div>