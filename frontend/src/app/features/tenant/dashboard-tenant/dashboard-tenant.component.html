<div class="dashboard-container">
    <div class="header">
        <h2>Dashboard - Khách Thuê</h2>
        <div class="date-display">{{ currentDate | date:'EEEE, d MMMM, y' }}</div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-label">Phòng hiện tại</span>
                <h3 class="stat-value">{{ getRoomName() }}</h3>
                <span class="stat-trend">{{ getBuildingName() }}</span>
            </div>
            <div class="stat-icon blue"><i class="fa-solid fa-home"></i></div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-label">Trạng thái hợp đồng</span>
                <h3 class="stat-value">{{ getContractStatus() }}</h3>
                <span class="stat-trend positive" *ngIf="currentContract">
                    {{ currentContract.startDate | date:'dd/MM/yyyy' }} - {{ currentContract.endDate | date:'dd/MM/yyyy'
                    }}
                </span>
            </div>
            <div class="stat-icon green"><i class="fa-solid fa-file-contract"></i></div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-label">Hóa đơn chưa thanh toán</span>
                <h3 class="stat-value">{{ unpaidInvoices }}</h3>
                <span class="stat-trend" [class.negative]="unpaidInvoices > 0">
                    {{ unpaidInvoices > 0 ? 'Cần thanh toán' : 'Đã thanh toán hết' }}
                </span>
            </div>
            <div class="stat-icon orange"><i class="fa-solid fa-file-invoice-dollar"></i></div>
        </div>

        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-label">Thanh toán kế tiếp</span>
                <h3 class="stat-value">{{ nextPaymentAmount | currency:'VND':'symbol':'1.0-0' }}</h3>
                <span class="stat-trend">
                    {{ nextPaymentAmount > 0 ? 'Cần thanh toán' : 'Không có' }}
                </span>
            </div>
            <div class="stat-icon purple"><i class="fa-solid fa-coins"></i></div>
        </div>
    </div>

    <!-- Charts -->
    <div class="charts-grid">
        <div class="chart-card">
            <h3>Lịch Sử Thanh Toán</h3>
            <div class="chart-container-line">
                <canvas #paymentHistoryChart></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h3>Trạng Thái Hóa Đơn</h3>
            <div class="chart-container-donut">
                <canvas #invoiceStatusChart></canvas>
                <div class="chart-center-text">
                    <strong>{{ totalInvoices }}</strong>
                    <span>Hóa đơn</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Invoices Table -->
    <div class="table-card">
        <div class="table-header">
            <h3>Hóa Đơn Gần Đây</h3>
            <a routerLink="/tenant/invoices" class="view-all-link">Xem tất cả <i
                    class="fa-solid fa-arrow-right"></i></a>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Tháng</th>
                    <th>Phòng</th>
                    <th>Số tiền</th>
                    <th>Trạng thái</th>
                    <th>Ngày tạo</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let inv of recentInvoices">
                    <td>{{ inv.month }}</td>
                    <td>{{ inv.roomName || 'N/A' }}</td>
                    <td class="font-bold">{{ inv.totalAmount | currency:'VND':'symbol':'1.0-0' }}</td>
                    <td>
                        <span class="badge" [class.success]="inv.status === 'PAID'"
                            [class.danger]="inv.status === 'OVERDUE'" [class.warning]="inv.status === 'UNPAID'">
                            {{ inv.status === 'PAID' ? 'Đã thanh toán' : (inv.status === 'UNPAID' ? 'Chưa thanh toán' :
                            'Quá hạn') }}
                        </span>
                    </td>
                    <td>{{ inv.createdAt | date:'dd MMM, yyyy' }}</td>
                    <td>
                        <button class="btn-action" *ngIf="inv.status !== 'PAID'" routerLink="/tenant/invoices">
                            <i class="fa-solid fa-credit-card"></i> Thanh toán
                        </button>
                    </td>
                </tr>
                <tr *ngIf="recentInvoices.length === 0">
                    <td colspan="6" class="empty-state">Chưa có hóa đơn nào.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Recent Notifications Table -->
    <div class="table-card">
        <div class="table-header">
            <h3>Thông Báo Gần Đây</h3>
            <a routerLink="/tenant/notification" class="view-all-link">Xem tất cả <i
                    class="fa-solid fa-arrow-right"></i></a>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Tiêu đề</th>
                    <th>Nội dung</th>
                    <th>Thời gian</th>
                    <th>Trạng thái</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let notif of recentNotifications">
                    <td class="font-bold">{{ notif.title }}</td>
                    <td>{{ notif.message }}</td>
                    <td>{{ notif.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
                    <td>
                        <span class="badge" [class.warning]="!notif.read" [class.success]="notif.read">
                            {{ notif.read ? 'Đã đọc' : 'Chưa đọc' }}
                        </span>
                    </td>
                </tr>
                <tr *ngIf="recentNotifications.length === 0">
                    <td colspan="4" class="empty-state">Chưa có thông báo nào.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>