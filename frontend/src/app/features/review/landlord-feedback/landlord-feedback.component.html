<div class="feedback-management-page">
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Quản lý phản hồi</h1>
      <p class="page-subtitle">Xem và xử lý yêu cầu từ khách thuê</p>
    </div>
  </div>

  <!-- Feedback List -->
  <div class="feedback-container">
    <div class="container-header">
      <div class="filter-tabs">
        <button 
          [class.active]="filterStatus === 'all'"
          (click)="setFilter('all')">
          Tất cả ({{ feedbacks.length }})
        </button>
        <button 
          [class.active]="filterStatus === 'PENDING'"
          (click)="setFilter('PENDING')">
          Chưa xử lý ({{ pendingCount }})
        </button>
        <button 
          [class.active]="filterStatus === 'PROCESSING'"
          (click)="setFilter('PROCESSING')">
          Đang xử lý ({{ processingCount }})
        </button>
        <button 
          [class.active]="filterStatus === 'RESOLVED'"
          (click)="setFilter('RESOLVED')">
          Đã xử lý ({{ resolvedCount }})
        </button>
      </div>
    </div>

    <div class="feedback-list" *ngIf="!loading">
      <div *ngIf="filteredFeedbacks.length === 0" class="empty-state">
        <i class="fa fa-inbox"></i>
        <p>Không có phản hồi nào</p>
      </div>

      <div *ngFor="let feedback of filteredFeedbacks" class="feedback-card">
        <div class="card-header">
          <h3 class="card-title">{{ feedback.title }}</h3>
          <span class="status-badge" [ngClass]="'status-' + feedback.status.toLowerCase()">
            {{ getStatusText(feedback.status) }}
          </span>
        </div>

        <div class="card-meta">
          <span class="meta-item">
            <i class="fa fa-user"></i>
            {{ feedback.tenant.user.fullName }}
          </span>
          <span class="meta-item">
            <i class="fa fa-clock"></i>
            {{ feedback.createdAt | date:'dd/MM/yyyy' }}
          </span>
          <span class="meta-item" *ngIf="feedback.room">
            <i class="fa fa-door-open"></i>
            {{ feedback.room.name }}
          </span>
        </div>

        <p class="card-description">{{ feedback.content }}</p>

        <div class="card-actions">
          <button 
            class="btn-primary" 
            *ngIf="feedback.status === 'PENDING'"
            (click)="startProcessing(feedback)">
            <i class="fa fa-play-circle"></i> Bắt đầu xử lý
          </button>
          
          <button 
            class="btn-primary" 
            *ngIf="feedback.status === 'PROCESSING'"
            (click)="openDetail(feedback)">
            <i class="fa fa-edit"></i> Chưa sẵn sàng thực
          </button>

          <button 
            class="btn-success" 
            *ngIf="feedback.status === 'RESOLVED'"
            (click)="openDetail(feedback)">
            <i class="fa fa-comment"></i> Trả lời
          </button>

          <button 
            class="btn-outline" 
            (click)="openDetail(feedback)">
            <i class="fa fa-eye"></i> Xem chi tiết
          </button>
        </div>
      </div>
    </div>

    <div class="loading" *ngIf="loading">
      <i class="fa fa-spinner fa-spin"></i> Đang tải...
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal-overlay" *ngIf="showDetailModal" (click)="closeDetail()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2><i class="fa fa-file-alt"></i> Chi tiết phản hồi</h2>
        <button class="btn-close" (click)="closeDetail()">
          <i class="fa fa-times"></i>
        </button>
      </div>

      <div class="modal-body" *ngIf="selectedFeedback">
        <div class="detail-section">
          <h3>Thông tin khách thuê</h3>
          <div class="info-grid">
            <div class="info-item">
              <i class="fa fa-user"></i>
              <div>
                <label>Tên khách thuê</label>
                <span>{{ selectedFeedback.tenant.user.fullName }}</span>
              </div>
            </div>
            <div class="info-item">
              <i class="fa fa-envelope"></i>
              <div>
                <label>Email</label>
                <span>{{ selectedFeedback.tenant.user.email }}</span>
              </div>
            </div>
            <div class="info-item">
              <i class="fa fa-door-open"></i>
              <div>
                <label>Phòng</label>
                <span>{{ selectedFeedback.room.name }} - {{ selectedFeedback.room.building.name }}</span>
              </div>
            </div>
            <div class="info-item">
              <i class="fa fa-calendar"></i>
              <div>
                <label>Thời gian gửi</label>
                <span>{{ selectedFeedback.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Nội dung phản hồi</h3>
          <div class="content-box">
            <h4>{{ selectedFeedback.title }}</h4>
            <p>{{ selectedFeedback.content }}</p>
          </div>

          <div class="attachment" *ngIf="selectedFeedback.attachmentUrl">
            <h4>Ảnh đính kèm</h4>
            <img [src]="selectedFeedback.attachmentUrl" alt="Attachment">
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedFeedback.status !== 'PENDING'">
          <h3>Trạng thái xử lý</h3>
          <div 
            class="status-box" 
            [style.background-color]="getStatusColor(selectedFeedback.status) + '20'"
            [style.border-left-color]="getStatusColor(selectedFeedback.status)">
            <i class="fa fa-{{getStatusIcon(selectedFeedback.status)}}"></i>
            <span>{{ getStatusText(selectedFeedback.status) }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3>Xử lý phản hồi</h3>
          
          <div class="form-group">
            <label>Ghi chú xử lý</label>
            <textarea 
              class="form-control" 
              rows="4"
              [(ngModel)]="processForm.landlordNote"
              placeholder="Nhập ghi chú về cách xử lý..."></textarea>
          </div>

          <div class="action-buttons">
            <button 
              class="btn-action processing"
              *ngIf="selectedFeedback.status === 'PENDING'"
              (click)="startProcessing(selectedFeedback)">
              <i class="fa fa-play"></i> Bắt đầu xử lý
            </button>

            <button 
              class="btn-action resolved"
              *ngIf="selectedFeedback.status === 'PROCESSING'"
              (click)="resolveFeedback(selectedFeedback.id)">
              <i class="fa fa-check"></i> Đánh dấu hoàn thành
            </button>

            <button 
              class="btn-action cancel"
              (click)="cancelFeedback(selectedFeedback.id)">
              <i class="fa fa-ban"></i> Hủy phản hồi
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>